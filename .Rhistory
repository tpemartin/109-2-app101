}
rlang::last_error()
for (.y in seq_along(list_heritageYears22)) {
lv1 <- .y # 第幾個
for (.x in seq_along(list_heritageYears22[[lv1]])) {
if(!is.na(as.numeric(list_heritageYears22[[lv1]][.x]))){
if(as.numeric(list_heritageYears22[[lv1]][.x]) > `start`|| as.numeric(list_heritageYears22[[lv1]][.x]) < `end`){
index_fits[length(index_fits)+1] <- names(list_heritageYears22[lv1])
}
}
}
}
unique(index_fits)
for (.y in seq_along(list_heritageYears22)) {
lv1 <- .y # 第幾個
for (.x in seq_along(list_heritageYears22[[lv1]])) {
if(!is.na(as.numeric(list_heritageYears22[[lv1]][.x]))){
if(as.numeric(list_heritageYears22[[lv1]][.x]) > `start`|| as.numeric(list_heritageYears22[[lv1]][.x]) < `end`){
index_fits[length(index_fits)+1] <- names(list_heritageYears22[lv1])
}
}
}
unique(index_fits)
}
for (.y in seq_along(list_heritageYears22)) {
lv1 <- .y # 第幾個
for (.x in seq_along(list_heritageYears22[[lv1]])) {
if(!is.na(as.numeric(list_heritageYears22[[lv1]][.x]))){
if(as.numeric(list_heritageYears22[[lv1]][.x]) > `start`|| as.numeric(list_heritageYears22[[lv1]][.x]) < `end`){
index_fits[length(index_fits)+1] <- names(list_heritageYears22[lv1])
}
unique(index_fits)
}
}
}
for (.y in seq_along(list_heritageYears22)) {
lv1 <- .y # 第幾個
for (.x in seq_along(list_heritageYears22[[lv1]])) {
if(!is.na(as.numeric(list_heritageYears22[[lv1]][.x]))){
if(as.numeric(list_heritageYears22[[lv1]][.x]) > `start`|| as.numeric(list_heritageYears22[[lv1]][.x]) < `end`){
index_fits[length(index_fits)+1] <- names(list_heritageYears22[lv1])
}
unique(index_fits)
}
}
}
for (.y in seq_along(list_heritageYears22)) {
lv1 <- .y # 第幾個
for (.x in seq_along(list_heritageYears22[[lv1]])) {
if(!is.na(as.numeric(list_heritageYears22[[lv1]][.x]))){
if(as.numeric(list_heritageYears22[[lv1]][.x]) > `start`|| as.numeric(list_heritageYears22[[lv1]][.x]) < `end`){
index_fits[length(index_fits)+1] <- names(list_heritageYears22[lv1])
unique(index_fits)
}
}
}
}
xfun::download_file("https://www.dropbox.com/s/vt10xxig64levmj/list_heritageYears.json?dl=1", mode="wb")
list_heritageYears <- jsonlite::fromJSON("list_heritageYears.json")
library(purrr)
library(lubridate)
library(stringr)
library(glue)
input_list <- list_heritageYears
.root <- rprojroot::is_rstudio_project$make_fix_file()
source(file.path(.root(),"weekly_progress/yuhong/transfer_to_num_list.R"),encoding = "UTF-8")
list_heritageYears <- input_list
rm(input_list, jp_period, ming, ming_num, ming_pattern, ming_pattern21, ming_pattern22, x, xxxx, xxxx_year, chinese_number_transfer)
names(list_heritageYears) <- 1:982
list_heritageYears22 <- list_heritageYears
#1 失敗
# for (.y in 1:200) { # 200 個是 lv1
#    if(str_detect(list_heritageYears22[.y], "1895-1945")){ # 找到有日治的 lv1
#      select_baby <- .y # 存是第幾個 lv1
#      length_of_lv2 <- length(list_heritageYears22[[.y]]) # 看 lv1 中有多少 lv2
#
#      map(
#        1:50, # 1896-1945 共 50 年
#      list_heritageYears22[[select_baby]][[length_of_lv2+.x]] <- as.character(1895+.x) # 在 lv2 最後逐一新增
#      )
#    }
#}
#2
for (.y in seq_along(list_heritageYears22)) {
if(length(which(str_detect(list_heritageYears22[[.y]], "1895-1945")))>0){
length_of_lv2 <- length(list_heritageYears22[[.y]])
add_start <- length_of_lv2 +1
add_end <- length_of_lv2 +50
list_heritageYears22[[.y]][add_start:add_end] <- as.character(1896:1945) # 取代不用 map
}
}
for (.y in seq_along(list_heritageYears22)) {
list_heritageYears22[[.y]] <- str_replace(list_heritageYears22[[.y]], pattern = "1895-1945" , replacement = "1895")
}
rm(add_start, add_end, length_of_lv2)
`start` <- 1855
`end` <- 1896
for (.y in seq_along(list_heritageYears22)) {
lv1 <- .y # 第幾個
for (.x in seq_along(list_heritageYears22[[lv1]])) {
if(!is.na(as.numeric(list_heritageYears22[[lv1]][.x]))){
if(as.numeric(list_heritageYears22[[lv1]][.x]) > `start`|| as.numeric(list_heritageYears22[[lv1]][.x]) < `end`){
index_fits[length(index_fits)+1] <- names(list_heritageYears22[lv1])
unique(index_fits)
}
}
}
}
index_fits <- list()
for (.y in seq_along(list_heritageYears22)) {
lv1 <- .y # 第幾個
for (.x in seq_along(list_heritageYears22[[lv1]])) {
if(!is.na(as.numeric(list_heritageYears22[[lv1]][.x]))){
if(as.numeric(list_heritageYears22[[lv1]][.x]) > `start`|| as.numeric(list_heritageYears22[[lv1]][.x]) < `end`){
index_fits[length(index_fits)+1] <- names(list_heritageYears22[lv1])
unique(index_fits)
}
}
}
}
list_heritageYears22[1]
index_fits <- list()
`start` <- 1855
`end` <- 1896
for (.y in seq_along(list_heritageYears22)) {
lv1 <- .y # 第幾個
for (.x in seq_along(list_heritageYears22[[lv1]])) {
if(!is.na(as.numeric(list_heritageYears22[[lv1]][.x]))){
if(as.numeric(list_heritageYears22[[lv1]][.x]) >= `start` && as.numeric(list_heritageYears22[[lv1]][.x]) <= `end`){
index_fits[length(index_fits)+1] <- names(list_heritageYears22[lv1])
unique(index_fits)
}
}
}
}
unique(index_fits)
index_fits <- c()
`start` <- 1855
`end` <- 1896
for (.y in seq_along(list_heritageYears22)) {
lv1 <- .y # 第幾個
for (.x in seq_along(list_heritageYears22[[lv1]])) {
if(!is.na(as.numeric(list_heritageYears22[[lv1]][.x]))){
if(as.numeric(list_heritageYears22[[lv1]][.x]) >= `start` && as.numeric(list_heritageYears22[[lv1]][.x]) <= `end`){
index_fits[length(index_fits)+1] <- names(list_heritageYears22[lv1])
unique(index_fits)
}
}
}
}
index_fits <- list()
index_fits <- list()
`start` <- 1855
`end` <- 1896
for (.y in seq_along(list_heritageYears22)) {
lv1 <- .y
for (.x in seq_along(list_heritageYears22[[lv1]])) {
if(!is.na(as.numeric(list_heritageYears22[[lv1]][.x]))){
if(as.numeric(list_heritageYears22[[lv1]][.x]) >= `start` && as.numeric(list_heritageYears22[[lv1]][.x]) <= `end`){
index_fits[length(index_fits)+1] <- names(list_heritageYears22[lv1])
unique(index_fits) # unique 失敗？
}
}
}
}
#
#    if(!is.na(as.numeric(list_heritageYears22[[lv1]][.x]))){
#
#      if(as.numeric(list_heritageYears22[[lv1]][.x]) >= `start` && as.numeric(list_heritageYears22[[lv1]][.x]) <= `end`){
#          index_fits[length(index_fits)+1] <- names(list_heritageYears22[lv1])
#          unique(index_fits) # unique 失敗？
#      }
#    }
#  }
#}
rm(`start`,`end`)
#
#    if(!is.na(as.numeric(list_heritageYears22[[lv1]][.x]))){
#
#      if(as.numeric(list_heritageYears22[[lv1]][.x]) >= `start` && as.numeric(list_heritageYears22[[lv1]][.x]) <= `end`){
#          index_fits[length(index_fits)+1] <- names(list_heritageYears22[lv1])
#          unique(index_fits) # unique 失敗？
#      }
#    }
#  }
#}
rm(lv1, `start`,`end`)
#    if(!is.na(as.numeric(list_heritageYears22[[lv1]][.x]))){
#
#      if(as.numeric(list_heritageYears22[[lv1]][.x]) >= `start` && as.numeric(list_heritageYears22[[lv1]][.x]) <= `end`){
#          index_fits[length(index_fits)+1] <- names(list_heritageYears22[lv1])
#          unique(index_fits) # unique 失敗？
#      }
#    }
#  }
#}
# rm(lv1, `start`,`end`)
unique(unlist(index_fits))
#    if(!is.na(as.numeric(list_heritageYears22[[lv1]][.x]))){
#
#      if(as.numeric(list_heritageYears22[[lv1]][.x]) >= `start` && as.numeric(list_heritageYears22[[lv1]][.x]) <= `end`){
#          index_fits[length(index_fits)+1] <- names(list_heritageYears22[lv1])
#          unique(index_fits) # unique 失敗？
#      }
#    }
#  }
#}
# rm(lv1, `start`,`end`)
index_fits<- unique(unlist(index_fits))
# index_fits <- list()
# `start` <- 1855
# `end` <- 1896
#
# for (.y in seq_along(list_heritageYears22)) {
#  lv1 <- .y
#  for (.x in seq_along(list_heritageYears22[[lv1]])) {
#
#    if(!is.na(as.numeric(list_heritageYears22[[lv1]][.x]))){
#
#      if(as.numeric(list_heritageYears22[[lv1]][.x]) >= `start` && as.numeric(list_heritageYears22[[lv1]][.x]) <= `end`){
#          index_fits[length(index_fits)+1] <- names(list_heritageYears22[lv1])
#          unique(index_fits) # unique 失敗？
#      }
#    }
#  }
#}
# rm(lv1, `start`,`end`)
# index_fits<- unique(unlist(index_fits))
filter_heritage <- function(list_heritageYears_converted, start, end=NA){
index_fits <- list()
for (.y in seq_along(list_heritageYears_converted)) {
lv1 <- .y
for (.x in seq_along(list_heritageYears_converted[[lv1]])) {
if(!is.na(as.numeric(list_heritageYears_converted[[lv1]][.x]))){
if(as.numeric(list_heritageYears_converted[[lv1]][.x]) >= start && as.numeric(list_heritageYears_converted[[lv1]][.x]) <= end){
index_fits[length(index_fits)+1] <- names(list_heritageYears_converted[lv1])
#unique(index_fits) # unique 失敗？
}
}
}
}
index_fits <- unique(unlist(index_fits))
return(index_fits)
}
filter_heritage(list_heritageYears, 1875, 1900)
filter_heritage(list_heritageYears, 1875, )
filter_heritage(list_heritageYears_converted,1930,)
filter_heritage(list_heritageYears, 1875, 1877)
# index_fits <- list()
# `start` <- 1855
# `end` <- 1896
#
# for (.y in seq_along(list_heritageYears22)) {
#  lv1 <- .y
#  for (.x in seq_along(list_heritageYears22[[lv1]])) {
#
#    if(!is.na(as.numeric(list_heritageYears22[[lv1]][.x]))){
#
#      if(as.numeric(list_heritageYears22[[lv1]][.x]) >= `start` && as.numeric(list_heritageYears22[[lv1]][.x]) <= `end`){
#          index_fits[length(index_fits)+1] <- names(list_heritageYears22[lv1])
#          unique(index_fits) # unique 失敗？
#      }
#    }
#  }
#}
# rm(lv1, `start`,`end`)
# index_fits<- unique(unlist(index_fits))
filter_heritage <- function(list_heritageYears_converted, start, end=NA){
index_fits <- list()
for (.y in seq_along(list_heritageYears_converted)) {
lv1 <- .y
for (.x in seq_along(list_heritageYears_converted[[lv1]])) {
if(!is.na(as.numeric(list_heritageYears_converted[[lv1]][.x]))){
if(end = NA){
# index_fits <- list()
# `start` <- 1855
# `end` <- 1896
#
# for (.y in seq_along(list_heritageYears22)) {
#  lv1 <- .y
#  for (.x in seq_along(list_heritageYears22[[lv1]])) {
#
#    if(!is.na(as.numeric(list_heritageYears22[[lv1]][.x]))){
#
#      if(as.numeric(list_heritageYears22[[lv1]][.x]) >= `start` && as.numeric(list_heritageYears22[[lv1]][.x]) <= `end`){
#          index_fits[length(index_fits)+1] <- names(list_heritageYears22[lv1])
#          unique(index_fits) # unique 失敗？
#      }
#    }
#  }
#}
# rm(lv1, `start`,`end`)
# index_fits<- unique(unlist(index_fits))
filter_heritage <- function(list_heritageYears_converted, start, end=NA){
index_fits <- list()
for (.y in seq_along(list_heritageYears_converted)) {
lv1 <- .y
for (.x in seq_along(list_heritageYears_converted[[lv1]])) {
if(!is.na(as.numeric(list_heritageYears_converted[[lv1]][.x]))){
if(is.na(end)){
if(as.numeric(list_heritageYears_converted[[lv1]][.x]) >= start){
index_fits[length(index_fits)+1] <- names(list_heritageYears_converted[lv1])
}else
{
if(as.numeric(list_heritageYears_converted[[lv1]][.x]) >= start && as.numeric(list_heritageYears_converted[[lv1]][.x]) <= end){
index_fits[length(index_fits)+1] <- names(list_heritageYears_converted[lv1])
}
}
}
}
}
index_fits <- unique(unlist(index_fits))
return(index_fits)
}
filter_heritage(list_heritageYears, 1875, 1877)
# index_fits <- list()
# `start` <- 1855
# `end` <- 1896
#
# for (.y in seq_along(list_heritageYears22)) {
#  lv1 <- .y
#  for (.x in seq_along(list_heritageYears22[[lv1]])) {
#
#    if(!is.na(as.numeric(list_heritageYears22[[lv1]][.x]))){
#
#      if(as.numeric(list_heritageYears22[[lv1]][.x]) >= `start` && as.numeric(list_heritageYears22[[lv1]][.x]) <= `end`){
#          index_fits[length(index_fits)+1] <- names(list_heritageYears22[lv1])
#          unique(index_fits) # unique 失敗？
#      }
#    }
#  }
#}
# rm(lv1, `start`,`end`)
# index_fits<- unique(unlist(index_fits))
filter_heritage <- function(list_heritageYears_converted, start, end=NA){
index_fits <- list()
for (.y in seq_along(list_heritageYears_converted)) {
lv1 <- .y
for (.x in seq_along(list_heritageYears_converted[[lv1]])) {
if(!is.na(as.numeric(list_heritageYears_converted[[lv1]][.x]))){
if(is.na(end)){
if(as.numeric(list_heritageYears_converted[[lv1]][.x]) >= start){
index_fits[length(index_fits)+1] <- names(list_heritageYears_converted[lv1])
}
}else
{
if(as.numeric(list_heritageYears_converted[[lv1]][.x]) >= start && as.numeric(list_heritageYears_converted[[lv1]][.x]) <= end){
index_fits[length(index_fits)+1] <- names(list_heritageYears_converted[lv1])
}
}
}
}
}
index_fits <- unique(unlist(index_fits))
return(index_fits)
}
filter_heritage(list_heritageYears, 1875, 1877)
filter_heritage(list_heritageYears, 1875, )
remotes::install_github("tpemartin/econR", force=T)
remotes::install_github("tpemartin/econR", force=T)
remotes::install_github("tpemartin/econR", force=T)
View(list_heritageYears)
View(list_heritageYears)
xfun::download_file("https://www.dropbox.com/s/vt10xxig64levmj/list_heritageYears.json?dl=1", mode="wb")
list_heritageYears <- jsonlite::fromJSON("list_heritageYears.json")
library(purrr)
library(lubridate)
library(stringr)
library(glue)
input_list <- list_heritageYears
.root <- rprojroot::is_rstudio_project$make_fix_file()
source(file.path(.root(),"weekly_progress/yuhong/transfer_to_num_list.R"),encoding = "UTF-8")
View(input_list)
list_heritageYears <- input_list
rm(input_list, jp_period, ming, ming_num, ming_pattern, ming_pattern21, ming_pattern22, x, xxxx, xxxx_year, chinese_number_transfer)
names(list_heritageYears) <- 1:982
list_heritageYears22 <- list_heritageYears
View(list_heritageYears)
View(list_heritageYears22)
xfun::download_file("https://www.dropbox.com/s/vt10xxig64levmj/list_heritageYears.json?dl=1", mode="wb")
list_heritageYears <- jsonlite::fromJSON("list_heritageYears.json")
View(list_heritageYears)
#1 失敗
# for (.y in 1:200) { # 200 個是 lv1
#    if(str_detect(list_heritageYears22[.y], "1895-1945")){ # 找到有日治的 lv1
#      select_baby <- .y # 存是第幾個 lv1
#      length_of_lv2 <- length(list_heritageYears22[[.y]]) # 看 lv1 中有多少 lv2
#
#      map(
#        1:50, # 1896-1945 共 50 年
#      list_heritageYears22[[select_baby]][[length_of_lv2+.x]] <- as.character(1895+.x) # 在 lv2 最後逐一新增
#      )
#    }
#}
#2
for (.y in seq_along(list_heritageYears22)) {
if(length(which(str_detect(list_heritageYears22[[.y]], "1895-1945")))>0){
length_of_lv2 <- length(list_heritageYears22[[.y]]) # 該古蹟有多少個年份資料
add_start <- length_of_lv2 +1 # 往後加的開始與結束，1896-1945 共 50 年
add_end <- length_of_lv2 +50
list_heritageYears22[[.y]][add_start:add_end] <- as.character(1896:1945) # 取代不用 map、同長度
}
}
for (.y in seq_along(list_heritageYears22)) {
list_heritageYears22[[.y]] <- str_replace(list_heritageYears22[[.y]], pattern = "1895-1945" , replacement = "1895")
}
rm(add_start, add_end, length_of_lv2) # 清乾淨
library(purrr)
library(lubridate)
library(stringr)
library(glue)
input_list <- list_heritageYears
.root <- rprojroot::is_rstudio_project$make_fix_file()
source(file.path(.root(),"weekly_progress/yuhong/transfer_to_num_list.R"),encoding = "UTF-8")
list_heritageYears <- input_list
rm(input_list, jp_period, ming, ming_num, ming_pattern, ming_pattern21, ming_pattern22, x, xxxx, xxxx_year, chinese_number_transfer)
names(list_heritageYears) <- 1:982
list_heritageYears22 <- list_heritageYears
#1 失敗
# for (.y in 1:200) { # 200 個是 lv1
#    if(str_detect(list_heritageYears22[.y], "1895-1945")){ # 找到有日治的 lv1
#      select_baby <- .y # 存是第幾個 lv1
#      length_of_lv2 <- length(list_heritageYears22[[.y]]) # 看 lv1 中有多少 lv2
#
#      map(
#        1:50, # 1896-1945 共 50 年
#      list_heritageYears22[[select_baby]][[length_of_lv2+.x]] <- as.character(1895+.x) # 在 lv2 最後逐一新增
#      )
#    }
#}
#2
for (.y in seq_along(list_heritageYears22)) {
if(length(which(str_detect(list_heritageYears22[[.y]], "1895-1945")))>0){
length_of_lv2 <- length(list_heritageYears22[[.y]]) # 該古蹟有多少個年份資料
add_start <- length_of_lv2 +1 # 往後加的開始與結束，1896-1945 共 50 年
add_end <- length_of_lv2 +50
list_heritageYears22[[.y]][add_start:add_end] <- as.character(1896:1945) # 取代不用 map、同長度
}
}
for (.y in seq_along(list_heritageYears22)) {
list_heritageYears22[[.y]] <- str_replace(list_heritageYears22[[.y]], pattern = "1895-1945" , replacement = "1895")
}
rm(add_start, add_end, length_of_lv2) # 清乾淨
View(list_heritageYears22)
View(list_heritageYears)
# index_fits <- list()
# `start` <- 1855
# `end` <- 1896
#
# for (.y in seq_along(list_heritageYears22)) {
#  lv1 <- .y
#  for (.x in seq_along(list_heritageYears22[[lv1]])) {
#
#    if(!is.na(as.numeric(list_heritageYears22[[lv1]][.x]))){
#
#      if(as.numeric(list_heritageYears22[[lv1]][.x]) >= `start` && as.numeric(list_heritageYears22[[lv1]][.x]) <= `end`){
#          index_fits[length(index_fits)+1] <- names(list_heritageYears22[lv1])
#          unique(index_fits) # unique 失敗？
#      }
#    }
#  }
#}
# rm(lv1, `start`,`end`)
# index_fits<- unique(unlist(index_fits))
filter_heritage <- function(list_heritageYears_converted, start, end=NA){
index_fits <- list() # 先將欲求結果設為空的 list，等等資料放裡面
for (.y in seq_along(list_heritageYears_converted)) { # 迴圈給定資料中每一古蹟
lv1 <- .y # 第幾個古蹟
for (.x in seq_along(list_heritageYears_converted[[lv1]])) { # 第 lv1 個古蹟中迴圈所有年份
if(!is.na(as.numeric(list_heritageYears_converted[[lv1]][.x]))){ # 拒絕處理無法轉成數字的年份
# 先處理 end 是 NA
if(is.na(end)){
if(as.numeric(list_heritageYears_converted[[lv1]][.x]) >= start){ # 如果取出年分 >= start 此古蹟就符合
index_fits[length(index_fits)+1] <- names(list_heritageYears_converted[lv1])
}
}else
# 再處理start、end 都給定
{
if(as.numeric(list_heritageYears_converted[[lv1]][.x]) >= start && as.numeric(list_heritageYears_converted[[lv1]][.x]) <= end){
index_fits[length(index_fits)+1] <- names(list_heritageYears_converted[lv1])
}
}
}
}
}
index_fits <- unique(unlist(index_fits)) # unique 他
return(index_fits)
}
filter_heritage(list_heritageYears, 1875, )
filter_heritage(list_heritageYears, 1875, )
filter_heritage(list_heritageYears, 1875, 1876)
source('C:/Users/su200/Documents/GitHub/109-2-app101/R/chinese_martin.R', encoding = 'UTF-8')
.root <- rprojroot::is_rstudio_project$make_fix_file()
source(file.path(.root(), "R/chinese_martin.R", encoding = "UTF-8"))
source(file.path(.root(), "R/chinese_martin.R", encoding = "UTF-8"))
source('C:/Users/su200/Documents/GitHub/109-2-app101/R/chinese_martin.R', encoding = 'UTF-8')
source(file.path(.root(), "R/chinese_martin.R", encoding = "UTF-8"))
source(file.path(.root(), "/R/chinese_martin.R", encoding = "UTF-8"))
source(file.path(.root(), R/chinese_martin.R, encoding = "UTF-8"))
source(file.path(.root(), "R/chinese_martin.R" , encoding = "UTF-8"))
chinese$convert_minguo2western("民國3七年")
chinese$convert_minguo2western("民國卅七年")
chinese$convert_minguo2western("民國卅十七年")
chinese$convert_minguo2western("民國卅七年")
source('C:/Users/su200/Documents/GitHub/109-2-app101/R/chinese_martin.R')
source('C:/Users/su200/Documents/GitHub/109-2-app101/R/chinese_martin.R')
chinese$convert_minguo2western("民國3七年")
chinese$convert_minguo2western("民國卅十七年")
chinese$convert_minguo2western("民國卅七年")
chinese$convert_minguo2western("民國卅十七年")
remotes::install_github("tpemartin/econR", force=T)
remotes::install_github("tpemartin/econR", force=T)
